# Simple working nginx configurationserver {server {

server {

    listen 80;    listen 80;    listen 80;

    server_name localhost;

    root /var/www/html;    server_name localhost;    server_name localhost;

    index index.html;

    root /var/www/html;    root /var/www/html;

    location / {

        try_files $uri $uri/ /index.html;    index index.html index.php;    index index.html index.php;

    }



    location /api/ {

        try_files $uri @api;    # Main application route    # Security headers

    }

    location / {    add_header X-Frame-Options "SAMEORIGIN" always;

    location @api {

        fastcgi_pass php:9000;        try_files $uri $uri/ /index.html;    add_header X-XSS-Protection "1; mode=block" always;

        include fastcgi_params;

        fastcgi_param SCRIPT_FILENAME /var/www/html/api$fastcgi_script_name;    }    add_header X-Content-Type-Options "nosniff" always;

        fastcgi_param DOCUMENT_ROOT /var/www/html/api;

    }    add_header Referrer-Policy "no-referrer-when-downgrade" always;

}
    # API routes    add_header Content-Security-Policy "default-src 'self' http: https: data: blob: 'unsafe-inline'" always;

    location /api/ {

        try_files $uri @php;    # Frontend routes

    }    location / {

        try_files $uri $uri/ /index.html;

    # PHP-FPM processing        

    location @php {        # PWA service worker

        fastcgi_pass php:9000;        location ~* (sw\.js|manifest\.json)$ {

        fastcgi_index index.php;            add_header Cache-Control "no-cache, no-store, must-revalidate";

        include fastcgi_params;            add_header Pragma "no-cache";

        fastcgi_param SCRIPT_FILENAME /var/www/html/api$fastcgi_script_name;            add_header Expires "0";

        fastcgi_param DOCUMENT_ROOT /var/www/html/api;        }

        fastcgi_read_timeout 300;        

    }        # Static assets caching

        location ~* \.(css|js|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {

    # Static files            expires 1y;

    location ~* \.(css|js|png|jpg|jpeg|gif|ico|svg)$ {            add_header Cache-Control "public, immutable";

        expires 1y;            add_header Vary Accept-Encoding;

        add_header Cache-Control "public, immutable";        }

    }    }



    # Deny access to sensitive files    # API routes

    location ~ /\. {    location /api {

        deny all;        try_files $uri $uri/ @php;

    }    }    # PHP processing

    location @php {

    # Error pages        fastcgi_pass php:9000;

    error_page 404 /index.html;        fastcgi_index index.php;

    error_page 500 502 503 504 /index.html;        include fastcgi_params;

}        fastcgi_param SCRIPT_FILENAME $document_root/api$fastcgi_script_name;
        fastcgi_param DOCUMENT_ROOT $document_root/api;
        fastcgi_read_timeout 300;
    }

    location ~ \.php$ {
        fastcgi_pass php:9000;
        fastcgi_index index.php;
        include fastcgi_params;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        fastcgi_read_timeout 300;
    }

    # Admin panel
    location /admin {
        try_files $uri $uri/ /admin/index.html;
    }

    # Deny access to sensitive files
    location ~ /\. {
        deny all;
    }
    
    location ~ /(composer\.(json|lock)|package\.(json|lock)|\.env|\.git) {
        deny all;
    }

    # Error pages
    error_page 404 /404.html;
    error_page 500 502 503 504 /50x.html;
    
    location = /50x.html {
        root /var/www/html;
    }

    # Logging
    access_log /var/log/nginx/bus_booking_access.log;
    error_log /var/log/nginx/bus_booking_error.log;
}
}