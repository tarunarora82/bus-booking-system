<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bus Booking System - Admin Panel</title>
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="../assets/css/styles.css">
    <link rel="stylesheet" href="../assets/css/enhanced-styles.css">
    
    <style>
        .admin-header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 20px 0;
            margin-bottom: 30px;
        }
        
        .admin-nav {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .admin-nav button {
            padding: 10px 20px;
            border: none;
            background: #3498db;
            color: white;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .admin-nav button:hover {
            background: #2980b9;
        }
        
        .admin-nav button.active {
            background: #e74c3c;
        }
        
        .admin-section {
            display: none;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        
        .admin-section.active {
            display: block;
        }
        
        .admin-section h3 {
            margin-top: 0;
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .form-group label {
            font-weight: 600;
            color: #2c3e50;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .data-table th,
        .data-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        .data-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .data-table tr:hover {
            background: #f8f9fa;
        }
        
        .status-active {
            color: #28a745;
            font-weight: 600;
        }
        
        .status-inactive {
            color: #dc3545;
            font-weight: 600;
        }
        
        .action-buttons {
            display: flex;
            gap: 5px;
        }
        
        .action-buttons button {
            padding: 5px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .btn-edit {
            background: #ffc107;
            color: #212529;
        }
        
        .btn-delete {
            background: #dc3545;
            color: white;
        }
        
        .btn-toggle {
            background: #6c757d;
            color: white;
        }
    </style>
</head>
<body>
    <div class="admin-header">
        <div class="container">
            <h1>üöå Bus Booking System - Admin Panel</h1>
            <p>Manage buses, employees, and system configuration</p>
        </div>
    </div>

    <div class="container">
        <!-- Navigation -->
        <div class="admin-nav">
            <button onclick="showSection('buses')" class="nav-btn active" data-section="buses">
                üöå Manage Buses
            </button>
            <button onclick="showSection('employees')" class="nav-btn" data-section="employees">
                üë• Employee Emails
            </button>
            <button onclick="showSection('bookings')" class="nav-btn" data-section="bookings">
                üìã View Bookings
            </button>
            <button onclick="showSection('settings')" class="nav-btn" data-section="settings">
                ‚öôÔ∏è System Settings
            </button>
        </div>

        <!-- Bus Management Section -->
        <div id="buses-section" class="admin-section active">
            <h3>Bus Fleet Management</h3>
            
            <div class="form-grid">
                <div class="form-group">
                    <label for="bus-number">Bus Number *</label>
                    <input type="text" id="bus-number" placeholder="e.g., BUS-004" required>
                </div>
                <div class="form-group">
                    <label for="bus-name">Bus Name *</label>
                    <input type="text" id="bus-name" placeholder="e.g., Late Night Express" required>
                </div>
                <div class="form-group">
                    <label for="departure-time">Departure Time *</label>
                    <input type="time" id="departure-time" required>
                </div>
                <div class="form-group">
                    <label for="arrival-time">Arrival Time *</label>
                    <input type="time" id="arrival-time" required>
                </div>
                <div class="form-group">
                    <label for="capacity">Seat Capacity *</label>
                    <input type="number" id="capacity" min="1" max="100" placeholder="45" required>
                </div>
                <div class="form-group">
                    <label for="bus-type">Bus Type *</label>
                    <select id="bus-type" required>
                        <option value="">Select Type</option>
                        <option value="morning">Morning</option>
                        <option value="evening">Evening</option>
                        <option value="night">Night</option>
                        <option value="special">Special</option>
                    </select>
                </div>
            </div>
            
            <div class="form-grid">
                <div class="form-group">
                    <label for="route">Route *</label>
                    <input type="text" id="route" placeholder="e.g., City Center ‚Üî Tech Park" required>
                </div>
                <div class="form-group">
                    <label for="driver-name">Driver Name</label>
                    <input type="text" id="driver-name" placeholder="e.g., John Doe">
                </div>
                <div class="form-group">
                    <label for="driver-contact">Driver Contact</label>
                    <input type="tel" id="driver-contact" placeholder="e.g., +1-234-567-8901">
                </div>
            </div>
            
            <div style="margin-bottom: 20px;">
                <button onclick="addBus()" class="btn btn-primary">
                    ‚ûï Add New Bus
                </button>
                <button onclick="loadBuses()" class="btn btn-secondary">
                    üîÑ Refresh List
                </button>
            </div>
            
            <table class="data-table" id="buses-table">
                <thead>
                    <tr>
                        <th>Bus Number</th>
                        <th>Name</th>
                        <th>Time</th>
                        <th>Capacity</th>
                        <th>Route</th>
                        <th>Driver</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Bus data will be loaded here -->
                </tbody>
            </table>
        </div>

        <!-- Employee Management Section -->
        <div id="employees-section" class="admin-section">
            <h3>Employee Email Management</h3>
            
            <div class="form-grid">
                <div class="form-group">
                    <label for="employee-id">Employee ID *</label>
                    <input type="text" id="employee-id" placeholder="e.g., 1234567" required>
                </div>
                <div class="form-group">
                    <label for="employee-email">Email Address *</label>
                    <input type="email" id="employee-email" placeholder="employee@company.com" required>
                </div>
                <div class="form-group">
                    <label for="employee-name">Full Name</label>
                    <input type="text" id="employee-name" placeholder="John Doe">
                </div>
                <div class="form-group">
                    <label for="employee-dept">Department</label>
                    <input type="text" id="employee-dept" placeholder="e.g., Engineering">
                </div>
            </div>
            
            <div style="margin-bottom: 20px;">
                <button onclick="registerEmployee()" class="btn btn-primary">
                    üë§ Register Employee
                </button>
                <button onclick="loadEmployees()" class="btn btn-secondary">
                    üîÑ Refresh List
                </button>
            </div>
            
            <table class="data-table" id="employees-table">
                <thead>
                    <tr>
                        <th>Employee ID</th>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Department</th>
                        <th>Registered</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Employee data will be loaded here -->
                </tbody>
            </table>
        </div>

        <!-- Bookings Section -->
        <div id="bookings-section" class="admin-section">
            <h3>Current Bookings</h3>
            <p>View all current bus bookings for today</p>
            
            <div style="margin-bottom: 20px;">
                <button onclick="loadBookings()" class="btn btn-primary">
                    üìã Load Today's Bookings
                </button>
            </div>
            
            <table class="data-table" id="bookings-table">
                <thead>
                    <tr>
                        <th>Booking ID</th>
                        <th>Employee ID</th>
                        <th>Bus Number</th>
                        <th>Bus Name</th>
                        <th>Date</th>
                        <th>Status</th>
                        <th>Created</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Booking data will be loaded here -->
                </tbody>
            </table>
        </div>

        <!-- Settings Section -->
        <div id="settings-section" class="admin-section">
            <h3>System Settings</h3>
            
            <div class="form-grid">
                <div class="form-group">
                    <label for="booking-window">Booking Window (hours)</label>
                    <input type="number" id="booking-window" value="48" min="1" max="168">
                    <small>How many hours in advance employees can book</small>
                </div>
                <div class="form-group">
                    <label for="cancellation-window">Cancellation Window (hours)</label>
                    <input type="number" id="cancellation-window" value="2" min="0" max="24">
                    <small>How many hours before departure cancellation is allowed</small>
                </div>
            </div>
            
            <div class="form-grid">
                <div class="form-group">
                    <label for="admin-email">Admin Email</label>
                    <input type="email" id="admin-email" value="transport-admin@company.com">
                </div>
                <div class="form-group">
                    <label for="from-email">System From Email</label>
                    <input type="email" id="from-email" value="bus-booking@company.com">
                </div>
            </div>
            
            <h4>Valid Email Domains</h4>
            <div class="form-group">
                <textarea id="valid-domains" rows="4" placeholder="@company.com
@subsidiary.com
@contractor.company.com">@company.com
@subsidiary.com
@contractor.company.com</textarea>
                <small>One domain per line</small>
            </div>
            
            <div style="margin-top: 20px;">
                <button onclick="saveSettings()" class="btn btn-primary">
                    üíæ Save Settings
                </button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="../assets/js/config.js"></script>
    <script src="../assets/js/utils.js"></script>
    <script src="../assets/js/bus-config.js"></script>
    <script src="../assets/js/modal.js"></script>

    <script>
        // Navigation
        function showSection(sectionName) {
            // Hide all sections
            document.querySelectorAll('.admin-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Remove active class from all nav buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected section
            document.getElementById(sectionName + '-section').classList.add('active');
            
            // Add active class to clicked nav button
            document.querySelector(`[data-section="${sectionName}"]`).classList.add('active');
            
            // Load data for the section
            if (sectionName === 'buses') loadBuses();
            if (sectionName === 'employees') loadEmployees();
            if (sectionName === 'bookings') loadBookings();
        }

        // Bus Management
        function addBus() {
            const busData = {
                bus_number: document.getElementById('bus-number').value,
                name: document.getElementById('bus-name').value,
                departure_time: document.getElementById('departure-time').value,
                arrival_time: document.getElementById('arrival-time').value,
                capacity: document.getElementById('capacity').value,
                type: document.getElementById('bus-type').value,
                route: document.getElementById('route').value,
                driver_name: document.getElementById('driver-name').value,
                driver_contact: document.getElementById('driver-contact').value
            };
            
            // Validate required fields
            if (!busData.bus_number || !busData.name || !busData.departure_time || 
                !busData.arrival_time || !busData.capacity || !busData.type || !busData.route) {
                ProfessionalModal.error('Please fill in all required fields', 'Validation Error');
                return;
            }
            
            try {
                const result = BUS_MANAGER.addBus(busData);
                ProfessionalModal.success(result.message, 'Bus Added');
                
                // Clear form
                document.getElementById('bus-number').value = '';
                document.getElementById('bus-name').value = '';
                document.getElementById('departure-time').value = '';
                document.getElementById('arrival-time').value = '';
                document.getElementById('capacity').value = '';
                document.getElementById('bus-type').value = '';
                document.getElementById('route').value = '';
                document.getElementById('driver-name').value = '';
                document.getElementById('driver-contact').value = '';
                
                // Reload buses table
                loadBuses();
                
            } catch (error) {
                ProfessionalModal.error(error.message, 'Error Adding Bus');
            }
        }

        function loadBuses() {
            const buses = BUS_MANAGER.getAllBuses();
            const tbody = document.querySelector('#buses-table tbody');
            
            tbody.innerHTML = buses.map(bus => `
                <tr>
                    <td><strong>${bus.bus_number}</strong></td>
                    <td>${bus.name}</td>
                    <td>${bus.departure_time} - ${bus.arrival_time}</td>
                    <td>${bus.capacity} seats</td>
                    <td>${bus.route}</td>
                    <td>${bus.driver_name || 'Not assigned'}</td>
                    <td class="${bus.active ? 'status-active' : 'status-inactive'}">
                        ${bus.active ? 'Active' : 'Inactive'}
                    </td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-toggle" onclick="toggleBus(${bus.id}, ${bus.active})">
                                ${bus.active ? 'Deactivate' : 'Activate'}
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        function toggleBus(busId, isActive) {
            try {
                const result = isActive ? 
                    BUS_MANAGER.deactivateBus(busId) : 
                    BUS_MANAGER.activateBus(busId);
                
                ProfessionalModal.success(result.message, 'Bus Status Updated');
                loadBuses();
                
            } catch (error) {
                ProfessionalModal.error(error.message, 'Error Updating Bus');
            }
        }

        // Employee Management
        function registerEmployee() {
            const employeeId = document.getElementById('employee-id').value;
            const email = document.getElementById('employee-email').value;
            const name = document.getElementById('employee-name').value;
            const department = document.getElementById('employee-dept').value;
            
            if (!employeeId || !email) {
                ProfessionalModal.error('Please fill in Employee ID and Email', 'Validation Error');
                return;
            }
            
            try {
                const result = EMPLOYEE_MANAGER.registerEmployeeEmail(employeeId, email, name, department);
                ProfessionalModal.success(result.message, 'Employee Registered');
                
                // Clear form
                document.getElementById('employee-id').value = '';
                document.getElementById('employee-email').value = '';
                document.getElementById('employee-name').value = '';
                document.getElementById('employee-dept').value = '';
                
                // Reload employees table
                loadEmployees();
                
            } catch (error) {
                ProfessionalModal.error(error.message, 'Error Registering Employee');
            }
        }

        function loadEmployees() {
            const employees = EMPLOYEE_MANAGER.getAllEmployees();
            const tbody = document.querySelector('#employees-table tbody');
            
            const employeeRows = Object.entries(employees).map(([id, employee]) => `
                <tr>
                    <td><strong>${id}</strong></td>
                    <td>${employee.name || 'Not provided'}</td>
                    <td>${employee.email}</td>
                    <td>${employee.department || 'Not specified'}</td>
                    <td>${new Date(employee.registered_at).toLocaleDateString()}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-edit" onclick="editEmployee('${id}')">Edit</button>
                        </div>
                    </td>
                </tr>
            `).join('');
            
            tbody.innerHTML = employeeRows || '<tr><td colspan="6" style="text-align: center;">No employees registered</td></tr>';
        }

        function editEmployee(employeeId) {
            const employee = EMPLOYEE_MANAGER.getEmployeeInfo(employeeId);
            if (employee) {
                document.getElementById('employee-id').value = employeeId;
                document.getElementById('employee-email').value = employee.email;
                document.getElementById('employee-name').value = employee.name || '';
                document.getElementById('employee-dept').value = employee.department || '';
            }
        }

        // Bookings Management
        function loadBookings() {
            // This would load from the API in a real implementation
            // For now, we'll show a placeholder
            const tbody = document.querySelector('#bookings-table tbody');
            tbody.innerHTML = '<tr><td colspan="7" style="text-align: center;">Booking data would be loaded from the API service</td></tr>';
        }

        // Settings
        function saveSettings() {
            ProfessionalModal.success('Settings saved successfully! (This is a demo - settings would be saved to server in production)', 'Settings Saved');
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', () => {
            loadBuses();
        });
    </script>
</body>
</html>